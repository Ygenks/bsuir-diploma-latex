\section{ОБЗОР ЛИТЕРАТУРЫ}
\label{sec:domain}

\subsection{Обзор существующих технологий}
\label{sub:domain:technologies_review}

Современные методы обработки изображений делятся на две основные категории: программная и аппаратная обработка.

Программная обработка производится на базе центрального процессора(CPU) и отличается высокой эффективностью
при использовании последовательных алгоритмов \cite{asano_dip_comp}. В задачах с высоким Data Level Parallelism по обработке гомогенных данных
центральный процессор значительно проигрывает более специализированным решениям,
из-за малого количества SIMD блоков для параллельной обработки данных \cite{axell_cpu_simd}.

Комбинация программных и аппаратных подходов лежит в основе обработки изображений на графическом процессоре (GPU).
Связка графического процессора и SDK для его программирования образует GPGPU (General-Purpose computing for GPU).
GPGPU основна на прицнипе SIMT, основанный на разделении задачи на несколько подзадач того же типа, но меньшего размера,
решаемые каждым потоком GPU по отдельности.
Такой подход является удачной комбинацией скорости разработки программы и специализации графического процессора
на параллельной обработке данных \cite{patterson_hennessy}.

Однако есть и существенные ограничения.
Латентность при обработке изображений на GPU слабодетерменирована, что усложняет использование GPGPU
в системах реального времени \cite{maceina_gpu_real_time}.
Отсутствует выбор периферийного интерфейса -- на момент написания,
графический процессоры подключаются исключительно по PCIe(PCI express), сильно ограничивая перечень устройств.
Соотношение производительности на ватт затрудняет применение во встраиваемых системах с автономным питанием \cite{fowers_gpu_power_consumption}.

ASIC(Application-Specific Integrated Circuit), как наиболее специализированное на конкретной задаче решение, выполняет обработку за минимально возможное время
и с минимальным энергопотреблением \cite{amara_asic_low_power}. Разработка специализированной интегральной схемы связана
с существенными затратами на проектирование --- окупаемость наступает лишь при выпуске партиями в несколько сотен тысяч единиц,
исключая возможность применения технологии малыми и средними предприятиями \cite{smith_asic_economy}.

Применение FPGA(Field Programmable Gate Array) достичь баланса между производительностью и конфигурируемостью конечного решения.
По сравнению с ASIC единовременные затраты на проектирование на несколько порядков ниже,
что идеально подходит для прототипирования и мелкосерийного производства \cite{zuchowski_asic_vs_fpga_cost}.
В отличие от GPU малое энергопотребление и небольшие размеры решений на FPGA прекрасно подходят
для встраиваемых систем \cite{berten_gpu_fpga_comparison}.
Последовательные алгоритмы, непригодные для реализации на GPU, могут выполняться
на интегрированом CPU или soft core процессоре, заметно упрощая передачу данных
между последовательным и параллельным вычислителем, решая подобную задачу
для связки GPU и CPU \cite{russo_softcore_fpga_vs_gpu}.

Таким образом, оптимальной технологией для реализации аппаратной системы обработки видеопотока,
с поддержкой модульности и достаточного быстродействия является технология FPGA.


\subsection{Технология FPGA}
\label{sub:domain:fpga}

FPGA(Field Programmable Gate Array) --- программируемые пользователем вентильные матрицы,
представляет собой наиболее общий и современный класс программируемой логики.
Основные области применения FPGA:
\begin{itemize}
  \item разработка блоков и систем на стадии их прототипирования, даже при дальнейшей их реализации на другой технологической базе;
  \item реализация конечных продуктов небольшого тиража, тем самым уменьшая затраты на проектирование до возможного минимума.
\end{itemize}

Данные характеристики обеспечиваются удачной комбинацией общих и узкоспециализированных средств
в пределах одной микросхемы. Внутренняя область FPGA содержит множество идентичных конфигурируемых логических блоков(КЛБ),
которые соединены трассами межсоединений. По периметру микросхемы расположены блоки ввода-вывода(БВВ).

Базовая структура FPGA приведена на рисунке~\ref{fig:domain:fpga:fpga_architecture}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.4]{ugrymov_fpga_artchitecture.png}
  \caption{ Фрагмент базовой архитектуры FPGA \cite{ugrymov_digital_circuit_engineering} }
  \label{fig:domain:fpga:fpga_architecture}
\end{figure}

Конфигурируемые логические блоки состоят из:
\begin{itemize}
  \item некоторого количества элементов выполняющих логические преобразования;
  \item набора мультиплексоров для перенаправления выходных сигналов логических преобразователей;
  \item триггеров для хранения значений сигналов.
\end{itemize}

Схема современного КЛБ на примере семейства Spartan компании Xilinx представлена на рисунке~\ref{fig:domain:fpga:clb}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.25]{ugrymov_fpga_clb.png}
  \caption{ Логический блок семейсва Spartan }
  \label{fig:domain:fpga:clb}
\end{figure}

Системы межсоединений проектируются в широком диапазоне технологических и архитектурных решений.
Основная цель при построении эффективной системы коммутации --- обеспечение максимальной коммутируемости блоков
при минимальном количестве элементов связи с предсказуемыми задержками сигналов. Обозрение данной тематики задача достаточно нетривиальная,
стоит лишь отметить, что предсказуемость задержек это ключевой фактор в выборе микросхемы для проектирования системы реального времени.

С каждым выводом микросхемы ассоциируется свой блок ввода-вывода, который может настраиваться как вход, выход или двунаправленный вывод.
Упрощенная схема блока В/В представлена на рисунке~\ref{fig:domain:fpga:io}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.25]{ugrymov_fpga_io.png}
  \caption{ Пример схемы блока ввода-вывода FPGA }
  \label{fig:domain:fpga:io}
\end{figure}

Блок разделен на две части для работы как на вход, так и на выход. Основной интерес представляют буферы с тремя состояниями
1 и 2. Они имеют програмимруемые уровни сигналов(КМОП или ТТЛ), что заметно упрощает подключение пользовательских периферийных устройств
напрямую к микросхеме без поключения внешнего преобразователя уровня.

Основными игроками на рынке микросхем FPGA являются Xilinx и Altera. Они производят чипы применимые как в военной и космической сферах,
так и для потребительских нужд. Микросхемы широко варьируются по количеству логических блоков, размеру
статической памяти, количеству блоков ввода-вывода и поддержкой специфических блоков.

Однако для проектирования и отладки системы важен выбор не только микросхемы,
но и отладочной платы с необходимым набором периферии. Подробное сравнение отладочных
плат с микросхемами последнего поколения от различных производителей показывает, что
платы с микросхемами Xilinx наиболее разнообразы и представлены в более широком ценовом диапазоне,
чем платы Altera \cite{fpga_boards_comparison}.
Вследствие чего сделан выбор применения микросхем Xilinx в дипломном проекте.

\subsection{Сравнение cемейств микросхем Xilinx}
\label{sub:domain:fpga_comparison}

Компания Xilix является технологическим лидером на рынке производства микросхем FPGA.
На данный момент наиболее актуальная линейка микросхем --- Xilinx 7 series\cite{7_series_overview}.
Продукты данной линейки покрывают всевозможные требования к микросхеме: от низкого энергопотребления, малого размера, низкой цены до
поддержки высокоскоростных интерфейсов и большого количества логических и DSP(Digital Signal Processing) блоков.

Седьмое поколение микросхем Xilinx делится на 4 основные категории:
\begin{itemize}
  \item Spartan-7: для недорогих и маломощных систем, требующих высокую производительность ввода-вывода.
    Имеет наименьшую площадь посадочного места во всей линейке;
  \item Artix-7: оптимизирован для маломощных приложений с требованиями по высокой пропуской способности логических и DSP блоков.
    Обладает наиболее высоким параметром производительности на ватт;
  \item Kintex-7: микросхема с лучшим соотношением цены к производительности;
  \item Virtex-7: лучшая в классе производительность с применением новейших производственных технологий.
\end{itemize}

Так как в системах обработки видео с помощью FPGA блоки DSP выполняют роль сопроцессора, то
основная нагрузка ложится на саму микросхему. Исходя из этого следует подбирать микросхему
руководствуюясь её предельной тактовой частоты и количества логических блоков\cite{7_series_selection_guide}.

Старшие микросхемы в линейке Spartan работают на частотах порядка 500 МГц, однако обладают слишком малым количеством
логических и DSP блоков.

FPGA линейки Virtex являются самым передовым решением компании, их характеристики превосходят необходимые требования,
но стоимость на порядок выше младших решений делает их выбор не оптимальным.

Семейства Kintex и Artix используют 28 нм техпроцесс, основное различие различается в количестве DSP блоков, что не является
ключевым фактором в выборе микросхемы. При схожих параметрах, микросхемы Artix стоят меньше чем Kintex\cite{artix_kintex_price_comparison},
что послужило основанием для выбора данного семейства в дипломном проекте.

% Плюсы fpga конкретно для DIP dark fantasies

% Параллелизм в алгоритмах обработки изображений существует в двух основых формах --- пространственный и временный.
% Реализации данных алгоритмов на FPGA потенциально могут использовать комбинацию двух форм.\cite{downton_dip_architectures}.

% В частости, в задачах обработки изображения, FPGA ценится за возможность применения в системах
% с динамической реконфигрурацией, в которых требуется быстрая смена настроек системы для подстраивания
% под изменяющиеся внешние параметры \cite{burns_fpga_run_time_reconf}.

% Можно добавить отдельную секцию про выбор платы, но это уже занадто

\subsection{Обзор платы AC701}
\label{sub:domain:ac701}

Плата AC701 от компании Xilinx представляет собой так называемый evaluation board,
содержащую весь возможный набор периферийных устройств подключемых к микропроцессору.
Среди них особый интерес представляют:
\begin{itemize}
  \item микросхема XC7A200T-2FBG676C семейства Artix-7;
  \item 1GB DDR3 SODIMM;
  \item программируемый осциллятор;
  \item FMC(FPGA Mezzanine Card);
  \item шина I2C разведённая ко всей программируемой на плате периферии;
  \item контроллер и коннектор HDMI.
\end{itemize}

Стурктурная схема платы представлена на рисунке~\ref{fig:domain:ac701:block_design}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.4]{ac701_block_design.png}
  \caption{ Блок схема платы AC701 }
  \label{fig:domain:ac701:block_design}
\end{figure}

SRAM микросхем FPGA не могут вместить полноразмерную фотографию, а тем более их поток, поэтому
для временного хранения приходящих кадров необходима оперативная память. % Можно добавить ссылку на расчёты во введении или привести новые для 2160/1080

Программируемый осциллятор позволяет подключать к дополнительной периферии, например камере, тактовый сигнал произвольной частоты.
Для задания опорной частоты используется шина I2C. Схема осциллятора представлена на рисунке~\ref{fig:domain:ac701:user_clock}
\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.3]{ac701_user_clock.png}
  \caption{ Программируемый осциллятор }
  \label{fig:domain:ac701:user_clock}
\end{figure}

Подключение произвольных периферийных устройств осуществляется через разъём FMC, поддерживающий передачу
выскочастотных дифференциальный и однополярных сигналов на частотах до 9 ГГц\cite[c. 57]{ac701_user_guide}.
К таким устройствам относятся любые источники высокочастотных данных, такие как камеры, приёмники сигналов и так далее.

Программирование устройств на плате осуществляется посредством записи внутренних регистов по шине I2C. Она служит основым
инструментом настройки и диагностирования состояния компонентов на плате. Точный список устройств показан на
рисунке~\ref{fig:domain:ac701:i2c}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.3]{ac701_i2c.png}
  \caption{ Топология шины I2C }
  \label{fig:domain:ac701:i2c}
\end{figure}

Обработанное видео передаётся через HDMI(High Definition Multimedia Interface) коннектор на устройство видеовывода либо дальнейшей обработки. В качестве
HDMI контроллера на плате установлен ADV7511KSTZ-P компании Analog Devices. Контроллер поддерживает передачу видео формата 1080p 60 Гц в
цветовом пространстве YCbCr 4:4:4, блоками по 24 бита. Более подробная информация содержится в \cite{adv7511_datasheet}.
Схема подключения контроллера представлена на рисунке~\ref{fig:domain:ac701:hdmi}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.3]{ac701_hdmi.png}
  \caption{ Схема подключения HDMI контроллера }
  \label{fig:domain:ac701:hdmi}
\end{figure}

\subsection{Обзор камер}
\label{sub:domain:camera}



\subsection{Вывод}
\label{sub:domain:summary}


